<!doctype html>
<html lang="de">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

<head>
<title>KMB</title>
    <meta name="description" content="Testing">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel = "stylesheet" href = "style.css">
</head>
<script src = "jquery-3.6.1.min.js">  </script>
<script src="site.js"></script>

<body onload="init();">
    
<div id="clock">--:--:--</div>
<br>
<div class="tabs">
    <button class="tab active" onclick="switchTab(event, 'Haltestellen')">Haltestellen</button>
    <button class="tab" onclick="switchTab(event, 'Linien')">Linien</button>
    <button class="tab" onclick="switchTab(event, 'Routenplaner')">Routenplaner</button>
</div>

<div id="Haltestellen" class="tabcontent current">
    <div class="BusStop">Lo Tsz Tin
    <div id="LoTszTin" class="anzeige">Lädt...</div>
    </div>
    <div class="BusStop">TCT
        <div id="TCT" class="anzeige">Lädt...</div>
        </div>
    <div class="BusStop">EHC Südwärts
        <div id="EHCS" class="anzeige">Lädt...</div>
    </div>
    <div class="BusStop">Sunway Gdn
        <div id="sunway" class="anzeige">Lädt...</div>
    </div>
    <div class="BusStop">Opp Sunway Gdn
        <div id="oppsunway" class="anzeige">Lädt...</div>
    </div>
    <div class="BusStop">Taikoo Pl
        <div id="TaikooPl" class="anzeige">Lädt...</div>
    </div>
    <div class="BusStop">EHC Nordwärts
        <div id="EHC" class="anzeige">Lädt...</div>
    </div>
    <div class="BusStop">TCT Nordwärts
        <div id="TCTN" class="anzeige">Lädt...</div>
    </div>
</div>
  
<div id="Linien" class="tabcontent">
    <table id="hii">
        <tr><th>Po Heung St</th><th>Po Heung Brdg</th><th>Windfield Gdn</th><th>Hi</th></tr>
        <tr><td><span class="circle"></span></td><td><span class="circle"></span></td><td><span class="circle"></span></td><td><span class="circle"></span></td></tr>
        <tr><td id="hello">--:--</td><td id="PHBrdg75K">--:--</td><td>--:--</td><td>--:--</td></tr>
    </table>

    </div>

</div>
  
  <div id="Routenplaner" class="tabcontent">
    <p>wird entwickelt...</p>
  </div>




<script> 
const json = '{"result":true, "count":42}';
const obj = JSON.parse(json);
console.log(obj['result']);

var tablehead = "<table><tr><th>Linie</th><th>Zeit</th><th>Ziel</th><th><span style='font-size:12px'>Abfahrt in</span></th></tr>";

function init(){
    var tabcontent;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (let i = 1; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
    tabcontent[i].className = tabcontent[i].className.replace(" current","");
    }
}

function getTime(){
    var timenow = "";
    $.ajax({
        type: 'GET',
        url:'http://worldtimeapi.org/api/timezone/Asia/Hong_Kong',
        dataType: 'json',
        async : false,
        success: function(data){
            datetimenow = data['datetime'].substring(0,19);
            timenow = data['datetime'].substring(11,19);
            $("#clock").html(timenow);
        }
    });
   
}

function refreshLinien(){
    document.getElementById("hello").innerHTML = getSingleRouteStop("9DF152ED984CD4A0","75K");
}

function refresh(){
    document.getElementById("LoTszTin").innerHTML = tablehead + getStop(["9AB9D810103D8382"]) + "</table>";
    document.getElementById("TCT").innerHTML = tablehead + getStop(["FFBEBD7068E01EA4"], ["307","680","681","673"]) + "</table>";
    document.getElementById("EHCS").innerHTML = tablehead + getStop(["9535298A652873DB"],["606","613"])+ "</table>";
    document.getElementById("sunway").innerHTML = tablehead + getStop(["633C082A94176ED0"],["307P","678"])+ "</table>";
    document.getElementById("oppsunway").innerHTML = tablehead + getStop(["75CE4282D2043790"],["606"])+ "</table>";
    document.getElementById("TaikooPl").innerHTML = tablehead + getStop(["FB4ACCBAB77BE615"])+ "</table>";
    document.getElementById("EHC").innerHTML = tablehead + getStop(["991E47DBD416B908","D678B3364437D16B"],["307","680","681","307P","673","678"]) + "</table>";
    document.getElementById("TCTN").innerHTML = tablehead + getStop(["9274EF6791CA3ED8"],["74B","74D","274X","74X","75X","307","307P"])+ "</table>";
    refreshLinien();
}

function switchTab(evt, tabname) {
  var tabcontent, tab;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (let i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
    tabcontent[i].className = tabcontent[i].className.replace(" current","");
  }
  tab = document.getElementsByClassName("tab");
  for (i = 0; i < tab.length; i++) {
    tab[i].className = tab[i].className.replace(" active", "");
  }
  document.getElementById(tabname).style.display = "block";
  setTimeout(function(){
    document.getElementById(tabname).className += " current";
  },10);
  evt.currentTarget.className += " active";
}

getTime();
setInterval(getTime,1000);
refresh();
setInterval(refresh,10000);
</script>
</body>
</html>