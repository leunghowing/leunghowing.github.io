<!doctype html>
<html>
<head>
<title>KMB</title>
    <meta name="description" content="Testing">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel = "stylesheet" href = "style.css">
</head>
<script src = "jquery-3.6.1.min.js">  </script>

<body>
    
<div id="Title">Nahrverkehr</div>
<div id="clock"></div>
<br><br>
<div class="BusStop">Lo Tsz Tin
<div id="LoTszTin" class="kmb">Loading...</div>
</div>
<div class="BusStop">EHC
    <div id="EHC" class="kmb">Loading...</div>
    </div>
<script> 
const json = '{"result":true, "count":42}';
const obj = JSON.parse(json);
console.log(obj['result']);

setInterval(getTime, 1000)

function getTime(){
    var timenow = "";
    $.ajax({
        type: 'GET',
        url:'http://worldtimeapi.org/api/timezone/Asia/Hong_Kong',
        dataType: 'json',
        async : false,
        success: function(data){
            timenow = data['datetime'].substring(11,19);
        }
    });
    $("#clock").html(timenow);
}
function getStop(stopid){
    var response = "<table><tr><th>Linie</th><th>Ziel</th><th>Abfahrt</th></tr>";
    $.ajax({
        type: 'GET',
        url:'https://data.etabus.gov.hk/v1/transport/kmb/stop-eta/'+ stopid,
        dataType: 'json',
        async : false,
        success: function(data){
            
            let j = 1;
            for(var i = 0; i < data['data'].length; i++ ){ 
                if(data['data'][i]['eta']!=null){
                    console.log("hi");
                    response = response + "<tr><td>" + data['data'][i]['route'] + "</td><td>"+ data['data'][i]['dest_tc'] + "</td><td>"+ data['data'][i]['eta'].substring(11,16) + "</td></tr>";
                    console.log(response);
                    j++;
                }
            }
            response = response + "</table>";
        }
    });
    return response;

   // return "No response";
}

document.getElementById("LoTszTin").innerHTML = getStop("9AB9D810103D8382");
document.getElementById("EHC").innerHTML = getStop("991E47DBD416B908") + getStop("D678B3364437D16B");


</script>
</body>
</html>